<?xml version="1.0" encoding="utf-8"?>
<base:BaseContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
                    xmlns:s="library://ns.adobe.com/flex/spark" 
                    xmlns:mx="library://ns.adobe.com/flex/mx"
                    xmlns:base="components.base.*"
                    xmlns:technologies="components.technologytree.*"
                    xmlns:unitsscreen="components.unitsscreen.*"
                    xmlns:screens="components.screens.*"
                    xmlns:notif="components.notifications.*"
                    xmlns:building="components.buildingsidebar.*"
                    xmlns:buildingSelected="components.buildingselectedsidebar.*"
                    xmlns:quests="components.quests.*"
                    xmlns:viewport="components.base.viewport.*"
                    xmlns:squadronsscreen="components.squadronsscreen.*"
                    xmlns:infoscreen="components.infoscreen.*"
                    xmlns:foliage="components.foliage.*"
                    xmlns:ratings="components.ratings.*"
                    xmlns:space="components.map.space.*"
                    xmlns:firstlogin="components.firstlogin.*"
                    xmlns:healing="components.healing.*"
                    xmlns:cchat="components.chat.*"
                    xmlns:alliance="components.alliance.*"
                    xmlns:credits="components.credits.*"
                    xmlns:player="components.player.*"
                    xmlns:defensiveportal="components.defensiveportal.*"
                    xmlns:market="components.market.*"
                    currentState="sidebarCollapsed" xmlns:screen="components.base.screen.*">
   <fx:Script>
      <![CDATA[
         import components.dailybonus.DailyBonusComp;
         import components.dailybonus.DailyBonusEvent;
         import components.popups.ActionConfirmationPopup;
         import components.skins.BuildButtonSkin;
         import components.skins.DailyBonusButtonSkin;
         
         import controllers.GlobalFlags;
         import controllers.dailybonus.DailyBonusCommand;
         import controllers.screens.MainAreaScreens;
         import controllers.screens.MainAreaScreensSwitch;
         import controllers.screens.SidebarScreens;
         import controllers.screens.SidebarScreensSwitch;
         
         import models.events.ScreensSwitchEvent;
         import models.solarsystem.MSSObject;
         
         import mx.events.FlexEvent;
         
         import utils.locale.Localizer;
         
         
         /**
          * Shows sidebar if it is not currently visible.
          */
         public function expandSidebar() : void
         {
            setCurrentState("sidebarExpanded");
         }
         
         
         /**
          * Hides the sidebar if it is visible.
          */
         public function collapseSidebar() : void
         {
            setCurrentState("sidebarCollapsed");
         }
         
         
         private function vstMainAreaStack_creationCompleteHandler(event:FlexEvent):void
         {
            var s:MainAreaScreensSwitch = MainAreaScreensSwitch.getInstance();
            s.setConfig({"defaultScreenName": MainAreaScreens.GALAXY});
            s.resetToDefault();
         }
         
         
         private function vstSidebarStack_creationCompleteHandler(event:FlexEvent):void
         {
            var s:SidebarScreensSwitch = SidebarScreensSwitch.getInstance();
            s.setViewStack(vstSidebarStack);
            s.setConfig({"defaultScreenName": SidebarScreens.EMPTY});
            s.resetToDefault();
         }
         
         private function showDailyBonus(): void
         {
            var popUp: ActionConfirmationPopup = new ActionConfirmationPopup();
            var cont: DailyBonusComp = new DailyBonusComp();
            cont.reward = ML.player.dailyBonus;
            cont.addEventListener(DailyBonusEvent.CLOSE_PANEL, 
               function(e: DailyBonusEvent):void
               {
                  popUp.close();
               });
            popUp.title = Localizer.string('Popups', 'title.dailyBonus');
            popUp.addElement(cont);
            popUp.confirmButtonLabel = Localizer.string('Quests', 'label.claimReward');
            popUp.cancelButtonLabel = Localizer.string('Quests', 'label.claimLater');
            popUp.confirmButtonClickHandler = function(button: Button):void
            {
               GlobalFlags.getInstance().lockApplication = true;
               new DailyBonusCommand(DailyBonusCommand.CLAIM, 
                  {'planetId': MSSObject(cont.planetSelector.selectedItem).id}
               ).dispatch();
            };
            popUp.show();
         }
         
      ]]>
   </fx:Script>
   <base:states>
      <s:State name="sidebarExpanded"/>
      <s:State name="sidebarCollapsed"/>
   </base:states>
   <s:Group left="0" top="0" bottom="0"
            right.sidebarCollapsed="0"
            right.sidebarExpanded="240"
            creationComplete="vstMainAreaStack_creationCompleteHandler(event)">
      <screen:ScreenContainer screenName="{MainAreaScreens.GALAXY}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.SOLAR_SYSTEM}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.PLANET}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.TECH_TREE}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.FACILITIES}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.UNITS}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.STORAGE}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.LOAD_UNLOAD}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.HEAL}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.INFO}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.NOTIFICATIONS}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.QUESTS}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.SQUADRONS}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.RATINGS}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.MARKET}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.PLAYER}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.DEFENSIVE_PORTAL}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.VIP}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.ALLY_RATINGS}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.ALLIANCE}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.WELCOME}"/>
      <screen:ScreenContainer screenName="{MainAreaScreens.CHAT}"/>
      <base:TopMessage bottom="20" horizontalCenter="0" width="100%" visible="false"/>
      <s:Button skinClass="components.skins.DailyBonusButtonSkin" left="0" top="200"
                visible="{ML.player.dailyBonus != null}" click="showDailyBonus()"/>
   </s:Group>
   
   <s:SkinnableContainer id="rightSidebarContainer"
                         styleName="rightSidebarContainer"
                         top="0" bottom="0" right="0"
                         width.sidebarCollapsed="0"
                         width.sidebarExpanded="240"
                         mouseEnabled.sidebarCollapsed="false"
                         mouseChildren.sidebarCollapsed="false">
      <mx:ViewStack id="vstSidebarStack"
                    left="0" right="0" top="0" bottom="0"
                    creationComplete="vstSidebarStack_creationCompleteHandler(event)">
         <s:NavigatorContent name="{SidebarScreens.EMPTY}" width="100%" height="100%"/>
         <s:NavigatorContent name="{SidebarScreens.CONSTRUCTION}" width="100%" height="100%">
            <building:BuildingSidebar width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.TECH_TREE_INFO}" width="100%" height="100%">
            <technologies:TechnologySelectedSidebar selectedModel="{ML.selectedTechnology}" width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.TECH_TREE_BASE}" width="100%" height="100%">
            <technologies:TechnologySidebar width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.BUILDING_SELECTED}" width="100%" height="100%">
            <buildingSelected:BuildingSelectedSidebar selectedModel="{ML.selectedBuilding}" width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.BLOCKING_FOLLIAGE}" width="100%" height="100%">
            <foliage:CFoliageSidebar width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.UNITS_ACTIONS}" width="100%" height="100%">
            <unitsscreen:UnitsSelectedSidebar width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.LOAD_UNLOAD}" width="100%" height="100%">
            <unitsscreen:LoadUnloadSidebar width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.HEAL}" width="100%" height="100%">
            <healing:HealingSidebar width="100%" height="100%"/>
         </s:NavigatorContent>
         <s:NavigatorContent name="{SidebarScreens.MARKET}" width="100%" height="100%">
            <market:MarketSidebar width="100%" height="100%"/>
         </s:NavigatorContent>
      </mx:ViewStack>
   </s:SkinnableContainer>
</base:BaseContainer>
