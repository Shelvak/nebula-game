<?xml version="1.0" encoding="utf-8"?>
<base:BaseSkin xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="library://ns.adobe.com/flex/mx"
               xmlns:base="components.base.*"
               xmlns:planet="components.gameobjects.planet.*"
               xmlns:building="components.gameobjects.building.*"
               mouseChildren="false">
   
   <fx:Metadata>
      [ResourceBundle("Buildings")]
      [HostComponent("components.gameobjects.building.MapBuilding")]
   </fx:Metadata>
   
   <fx:Binding source="Building(hostComponent.model)" destination="b"/>
   
   <fx:Script>
      <![CDATA[
         import config.Config;
         
         import models.building.Building;
         
         [Bindable]
         private var b:Building = null;
      ]]>
   </fx:Script>
   
   <base:states>
      <s:State name="normal"/>
   </base:states>
   
   <base:SpinnerContainer id="spinnerContainer"
                          left="0" right="0" top="0" bottom="0"
                          timeoutEnabled="false">
      
      <!-- layer 0: basement which is shown when building is selected -->
      <planet:PlanetObjectBasement
         id="basement" right="0" bottom="0"
         logicalWidth="{b.width}" logicalHeight="{b.height}"
         alpha="0.3" chromeColor="0x00FF00"/>
      
      <!-- layer 1: building image -->
      <s:Group id="grpImagesContainer" top="0" left="0" bottom="0" right="0">
         <s:BitmapImage id="alphaImage" width="100%" height="100%" alpha="0.5"/>
         <s:BitmapImage id="mainImage" width="100%" height="100%" alpha="1"/>
         <building:LevelDisplay id="levelIndicator" currentLevel="{b.upgradePart.level}"
                                maxLevel="{Config.getBuildingMaxLevel(b.type)}"
                                visible="{!(b.isGhost || b.npc)}" active="{b.state != Building.INACTIVE}"/>
      </s:Group>
      
      <!-- layer 2: indication bars -->
      
      <!-- HP bar -->
      <mx:ProgressBar id="pbarHPBar" left="30" right="30" top="0"
                      label="{b.hp} / {b.maxHp}"
                      labelPlacement="center" mode="manual">
         <mx:visible>
               {!b.isGhost &amp;&amp; (b.isDamaged || !b.upgradePart.upgradeCompleted || hostComponent.selected)}
         </mx:visible>
      </mx:ProgressBar>
      
      <!-- Construction progress bar -->
      <mx:ProgressBar id="pbarConstructionProgressBar" left="30" right="30" top="25"
                      label="{RM.getString('Buildings', 'property.timeToFinish.long', 
                      [b.upgradePart.timeToFinishString])}"
                      labelPlacement="center" mode="manual">
         <mx:visible>
            {!b.isGhost &amp;&amp; !b.upgradePart.upgradeCompleted}
         </mx:visible>
      </mx:ProgressBar>
      
   </base:SpinnerContainer>
   
</base:BaseSkin>
