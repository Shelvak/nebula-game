<?xml version="1.0" encoding="utf-8"?>
<base:BaseContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
                    xmlns:s="library://ns.adobe.com/flex/spark" 
                    xmlns:mx="library://ns.adobe.com/flex/halo"
                    xmlns:base="components.base.*"
                    xmlns:technology="components.technologytree.*" 
                    xmlns:buildingsidebar="components.buildingsidebar.*"
                    creationComplete="techSidebar_creationCompleteHandler(event)">
   
   <fx:Script>
      <![CDATA[
         import com.developmentarc.core.utils.EventBroker;
         
         import controllers.screens.SidebarScreens;
         
         import globalevents.GScreenChangeEvent;
         
         import models.parts.events.UpgradeEvent;
         import models.resource.ResourceType;
         import models.technology.Technology;
         
         import mx.events.FlexEvent;
         
         import utils.Localizer;		
         
         [Bindable]
         private var hasActive: Boolean = false;
         
         
         
         protected function techSidebar_creationCompleteHandler(event:FlexEvent):void
         {
            EventBroker.subscribe(GScreenChangeEvent.SIDEBAR_CHANGE, prepareList);
         }
         
         private function refreshResearchElements(): void
         {
               researchContainer.removeAllElements();
               hasActive = false;
               for each(var element: Technology in ML.technologies.technologies)
               {
                  if ((!element.upgradePart.upgradeCompleted) || (element.pauseRemainder > 0))
                  {
                     var temp: ResearchElement = new ResearchElement();
                     temp.researchModel = element;
                     temp.width = 210;
                     element.upgradePart.addEventListener(UpgradeEvent.LVL_CHANGE, handleUpgradeComplete);
                     researchContainer.addElement(temp);
                     hasActive = true;
                  }
               }
         }
         
         public function prepareList(e: GScreenChangeEvent): void
         {
            if (e.newScreenName == SidebarScreens.TECH_TREE_BASE)
            {
               refreshResearchElements();
            }
         }
         
         private function handleUpgradeComplete(e: UpgradeEvent): void
         {
            refreshResearchElements();
         }
         

         
      ]]>
   </fx:Script>
   <base:AdvancedContainer width="100%">
      
      <base:Panel width="100%" title="{Localizer.string ('Technologies', 'scientistsAvailable')}">
         <base:ImageAndLabel type="{ResourceType.SCIENTISTS}" 
                             toolTip="{Localizer.string('Resources', ResourceType.SCIENTISTS)}"
                             textToDisplay="{ML.player.scientists.toString() + ' / ' + 
                             ML.player.scientistsTotal.toString()}"/>
         <s:Label width="90%" horizontalCenter="0" text="{Localizer.string ('Technologies', 'buildCenters')}"/>
         <base:layout>
            <s:VerticalLayout paddingLeft="6" gap="12"/>
         </base:layout>
      </base:Panel>
      
      <base:Panel id="researchPanel" width="100%" title="{Localizer.string ('Technologies', 'currentlyResearching')}"
                         visible="{hasActive}">
         <base:AdvancedContainer id="researchContainer" left="0" right="0">
            <base:layout>
               <s:VerticalLayout/>
            </base:layout>
         </base:AdvancedContainer>
      </base:Panel>
      
      <base:layout>
         <s:VerticalLayout/>
      </base:layout>
      
   </base:AdvancedContainer>
   
</base:BaseContainer>
