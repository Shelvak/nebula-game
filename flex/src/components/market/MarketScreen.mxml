<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
         xmlns:s="library://ns.adobe.com/flex/spark" 
         xmlns:mx="library://ns.adobe.com/flex/mx" 
         xmlns:ui="components.ui.*"
         width="100%" height="100%" 
         xmlns:market="components.market.*">
   <fx:Script>
      <![CDATA[
         import components.market.events.MarketEvent;
         
         import models.ModelsCollection;
         import models.market.MCMarketScreen;
         import models.market.MarketOffer;
         import models.resource.ResourceType;
         
         import utils.locale.Localizer;
         
         
         private var _filterWhat:String;
         private var _filterTo:String;
         private function setTypeFilter(_what: String, _to: String) : void
         {
            if (_filterWhat != _what || _filterTo != _to)
            {
               _filterWhat = _what;
               _filterTo = _to;
            }
         }
         
         private function getText(prop: String, params: Array = null): String
         {
            return Localizer.string('Market', prop, params);
         }
         

         protected function cFilter_selectedResourceChangeHandler(event:MarketEvent):void
         {
            function filterList(list: ModelsCollection): void
            {
               setTypeFilter(cFilter.selectedFrom, cFilter.selectedTo);
               list.filterFunction = function (item: MarketOffer): Boolean
               {
                  return (_filterWhat == null || item.fromKind == _filterWhat)
                  && (_filterTo == null || _filterTo == ResourceType.ALL || item.toKind == _filterTo);
               }
               list.refresh();
            }
            filterList(mScreen.privateOffers);
            filterList(mScreen.publicOffers);
         }
         
         [Bindable]
         private var mScreen: MCMarketScreen = MCMarketScreen.getInstance();

      ]]>
   </fx:Script>
   <market:CMarketOfferFilter top="10" id="cFilter" left="10" right="10"
                              selectedResourceChange="cFilter_selectedResourceChangeHandler(event)"/>
   <market:CMarketOffers id="offersList" top="{cFilter.height + 20}" 
                         bottom="{offersList.selected != null?cAction.height + 20:10}"
                         offers="{cFilter.onlyPrivateOffers
                         ? mScreen.privateOffers
                         : mScreen.publicOffers}" left="10" right="10"/>
   <market:CMarketOfferAction selectedOffer="{offersList.selected}" 
                              visible="{offersList.selected != null}"
                              id="cAction" bottom="10" left="10" right="10"/>
</s:Group>
