<?xml version="1.0" encoding="utf-8"?>
<s:Skin xmlns:fx="http://ns.adobe.com/mxml/2009"
        xmlns:s="library://ns.adobe.com/flex/spark"
        xmlns:layouts="ext.flex.spark.layouts.*"
        xmlns:base="components.base.*"
        xmlns:ui="components.ui.*"
        mouseEnabled="false"
        minWidth="20" minHeight="20">
   
   <s:states>
      <s:State name="normal"/>
      <s:State name="disabled"/>
   </s:states>
   
   <fx:Metadata>
      [HostComponent("components.movement.CSquadronPopup")]
   </fx:Metadata>
   
   <fx:Script>
      <![CDATA[
         import mx.events.PropertyChangeEvent;
         
         import utils.assets.AssetNames;
         import utils.assets.ImagePreloader;
         
         
         private function getImg(key:String) : BitmapData
         {
            return ImagePreloader.getInstance().getImage(AssetNames.MOVEMENT_IMAGES_FOLDER + "squad_popup_" + key);
         }
         
         
         protected override function initializationComplete() : void
         {
            super.initializationComplete();
            hostComponent.addEventListener(PropertyChangeEvent.PROPERTY_CHANGE, host_propertyChangeHandler);
            updateLocButtonsImage();
         }
         
         
         private function host_propertyChangeHandler(event:PropertyChangeEvent) : void
         {
            if (event.property == "showDestLoc")
            {
               updateLocButtonsImage();
            }
         }
         
         
         private function updateLocButtonsImage() : void
         {
            if (hostComponent.showDestLoc)
            {
               imgLocButtons.height = 100;
            }
            else
            {
               imgLocButtons.height = 47;
            }
         }
      ]]>
   </fx:Script>
   
   <base:SpinnerContainer busy="{hostComponent.squadron.pending}" left="-7" right="0" top="-33" bottom="0"
                          mouseEnabled="false">
      <!-- squad owner -->
      <s:Group left="36" top="0" width="287" mouseEnabled="false">
         <s:Group left="0" right="0" top="0" bottom="0" mouseEnabled="false">
            <s:layout>
               <s:HorizontalLayout gap="0"/>
            </s:layout>
            <s:BitmapImage source="{getImg('owner_left')}"/>
            <s:BitmapImage source="{getImg('owner_center')}" fillMode="repeat" width="100%"/>
            <s:BitmapImage source="{getImg('owner_right')}"/>
         </s:Group>
         <s:Group left="30" right="0" top="4" bottom="0" mouseEnabled="false">
            <s:layout>
               <s:HorizontalLayout verticalAlign="middle" gap="5"/>
            </s:layout>
            <s:Label id="lblOwner" styleName="ownerTitle"/>
            <ui:PlayerProfileButton id="btnOwner"/>
         </s:Group>
      </s:Group>
      
      
      <!-- units list background -->
      <s:Group left="0" right="0" top="20" mouseEnabled="false" mouseChildren="false">
         <s:layout>
            <s:HorizontalLayout gap="0"/>
         </s:layout>
         <s:BitmapImage source="{getImg('left')}"/>
         <s:BitmapImage source="{getImg('center')}" fillMode="repeat" width="100%"/>
         <s:BitmapImage source="{getImg('right')}"/>
      </s:Group>
      
      <!-- units list -->
      <s:List id="lstUnits" left="35" top="30" right="25" height="156" useVirtualLayout="true"
              skinClass="components.movement.skins.CSquadronUnitsListSkin"
              visible="{lstUnits.dataProvider.length &lt; 11}"/>
      <!-- units list -->
      <s:List id="lstCachedUnits" left="35" top="30" right="25" height="156"
              skinClass="components.movement.skins.CSquadronCachedUnitsListSkin"
              visible="{lstUnits.dataProvider.length > 10}"/>
      
      <!-- squadron management buttons -->
      <s:Group left="210" right="16" top="193" mouseEnabled="false">
         <s:layout><s:HorizontalLayout horizontalAlign="right"/></s:layout>
         <s:Button id="btnStop"/>
         <s:Button id="btnMove"/>
         <s:Button id="btnUnitsManagement"/>
      </s:Group>
      
      <!-- source and destination locations -->
      <s:Group left="35" top="209" mouseEnabled="false" visible="{hostComponent.showSourceLoc || hostComponent.showDestLoc}">
         <s:BitmapImage id="imgLocBackground" source="{getImg('loc_background')}"/>
         <s:Group left="20" right="12" top="7" mouseEnabled="false">
            <s:BitmapImage id="imgLocButtons" right="0" source="{getImg('loc_buttons')}" fillMode="clip"/>
            
            <s:Button id="btnOpenSourceLoc" right="5" width="78" top="22" visible="{hostComponent.showSourceLoc}"/>
            <s:Label id="lblSourceLocTitle" left="0" top="14" fontWeight="bold" visible="{hostComponent.showSourceLoc}"/>
            <s:Label id="lblSourceLoc" left="0" top="29" visible="{hostComponent.showSourceLoc}"/>
            
            <s:Button id="btnOpenDestLoc" right="5" width="78" top="75" visible="{hostComponent.showDestLoc}"/>
            <s:Label id="lblDestLocTitle" left="0" top="63" fontWeight="bold" visible="{hostComponent.showDestLoc}"/>
            <s:Label id="lblDestLoc" left="0" top="78" visible="{hostComponent.showDestLoc}"/>
            <s:Label id="lblArrivesIn" left="0" top="105" fontWeight="bold" visible="{hostComponent.showDestLoc}"/>
         </s:Group>
      </s:Group>
      
   </base:SpinnerContainer>
   
</s:Skin>
